<!DOCTYPE html>  <html> <head>   <title>library_browser.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               library_browser.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>Library Browser 3</h1>

<p>This is the current iteration of the library browser for webwork.
It's built out of models contained in the <code>webwork.*</code> framework that
you can find in the <code>js/lib</code> folder.</p>

<p>The idea was to use this as a proof of concept of how to write single page
webapps for webwork out of a general client side framework quickly, easily
and in a way that's maintainable.</p>

<p>The javascript framework is currently written with extensibility in mind.
So base models in the webwork.js file are added too and additional models are
provided for different situations.  For instance since library browser is used
by teachers we include the files in the <code>teacher</code> subdirectory and add in features
like adding and remove problems from a sets ProblemList and browsing a Library.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Start things off by wrapping everything in jquery so it will load after the dom is ready.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Since many of the views we'll define will all want to post alerts and messages to the same place
we define a global template and alert function for them.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">alert_template</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;alert &lt;%= classes %&gt; fade in&quot;&gt;&lt;a class=&quot;close&quot; data-dismiss=&quot;alert&quot; href=&quot;#&quot;&gt;Ã—&lt;/a&gt;&lt;%= message %&gt;&lt;/div&gt;&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>set up alerts to close</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">().</span><span class="nx">alert</span><span class="p">();</span>

    <span class="kd">var</span> <span class="nx">alert</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">classes</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#messages&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">alert_template</span><span class="p">({</span><span class="nx">message</span><span class="o">:</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">classes</span><span class="o">:</span> <span class="nx">classes</span><span class="p">}));</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.alert&quot;</span><span class="p">).</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">)},</span> <span class="mi">5000</span><span class="p">);</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h2>The problem View</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>A view defined for the browser app for the webwork Problem model.
There's no reason this same view couldn't be used in other pages almost as is.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">ProblemView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>We want the problem to render in a <code>li</code> since it will be included in a list</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">tagName</span><span class="o">:</span><span class="s2">&quot;li&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Add the 'problem' class to every problem</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">className</span><span class="o">:</span> <span class="s2">&quot;problem&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>This is the template for a problem, the html is defined in SetMaker3.pm</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">template</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#problem-template&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">()),</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Register events that a problem's view should listen for,
in this case it removes the problem if the button with class 'remove' is clicked.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">events</span><span class="o">:</span><span class="p">{</span>
            <span class="s2">&quot;click .remove&quot;</span><span class="o">:</span> <span class="s1">&#39;clear&#39;</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>In most model views initialize is used to set up listeners
on the views model.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">initialize</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change:data&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">remove_display</span><span class="p">){</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">remove_display</span> <span class="o">=</span> <span class="s2">&quot;block&quot;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">remove</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">render</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">problem</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

            <span class="k">if</span><span class="p">(</span><span class="nx">problem</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)){</span>
                <span class="kd">var</span> <span class="nx">jsonInfo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>
                <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">jsonInfo</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">options</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">jsonInfo</span><span class="p">));</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;img src=&quot;/webwork2_files/images/ajax-loader.gif&quot; alt=&quot;loading&quot;/&gt;&#39;</span><span class="p">);</span>
                <span class="nx">problem</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;data-path&#39;</span><span class="p">,</span> <span class="nx">problem</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">));</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">cid</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">draggable</span><span class="p">({</span>
                <span class="nx">helper</span><span class="o">:</span><span class="s1">&#39;clone&#39;</span><span class="p">,</span>
                <span class="nx">revert</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
                <span class="nx">handle</span><span class="o">:</span><span class="s1">&#39;.problem&#39;</span><span class="p">,</span>
                <span class="nx">appendTo</span><span class="o">:</span><span class="s1">&#39;body&#39;</span><span class="p">,</span>
                <span class="nx">cursorAt</span><span class="o">:</span><span class="p">{</span>
                    <span class="nx">top</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="nx">left</span><span class="o">:</span><span class="mi">0</span>
                <span class="p">},</span>
                <span class="nx">opacity</span><span class="o">:</span><span class="mf">0.35</span>
            <span class="p">});</span>


            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">clear</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h2>The library View</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">LibraryView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span><span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#Library-template&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">()),</span>

        <span class="nx">events</span><span class="o">:</span><span class="p">{</span>
            <span class="s2">&quot;click .next_group&quot;</span><span class="o">:</span> <span class="s2">&quot;loadNextGroup&quot;</span>
        <span class="p">},</span>

        <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">group_size</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;syncing&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;[href=#&quot;</span><span class="o">+</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;syncing&quot;</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;[href=#&quot;</span><span class="o">+</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;syncing&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">){</span><span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);});</span>

            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)){</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">fetch</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>

            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#problems_container #&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)).</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#problems_container&#39;</span><span class="p">).</span><span class="nx">tabs</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">);</span> <span class="c1">//could move to an after?</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">setElement</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)));</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>select</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#problems_container&#39;</span><span class="p">).</span><span class="nx">tabs</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">));</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;[href=#&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">syncing</span><span class="p">){</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;[href=#&quot;</span><span class="o">+</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;syncing&quot;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;library_tab&quot;</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="kd">var</span> <span class="nx">jsonInfo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>
            <span class="nx">jsonInfo</span><span class="p">[</span><span class="s1">&#39;group_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">group_size</span><span class="p">;</span>

            <span class="nx">jsonInfo</span><span class="p">[</span><span class="s1">&#39;enough_problems&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">startIndex</span><span class="p">)</span><span class="o">?</span> <span class="s2">&quot;block&quot;</span> <span class="o">:</span> <span class="s2">&quot;none&quot;</span><span class="p">;</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">jsonInfo</span><span class="p">));</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">loadNextGroup</span><span class="p">();</span>

            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Define a new function loadNextGroup so that we can just load a few problems at once,
otherwise things get unwieldy :P</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">loadNextGroup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;load more&quot;</span><span class="p">);</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">startIndex</span><span class="p">);</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">group_size</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">problems</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">);</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">problems</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
            <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">group_size</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">startIndex</span> <span class="o">&lt;</span> <span class="nx">problems</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">startIndex</span><span class="o">++</span><span class="p">){</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;adding a problem&quot;</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">problem</span> <span class="o">=</span> <span class="nx">problems</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">startIndex</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProblemView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="nx">problem</span><span class="p">,</span> <span class="nx">remove_display</span><span class="o">:</span> <span class="s2">&quot;none&quot;</span><span class="p">});</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.list&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">startIndex</span><span class="p">)){</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.next_group&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">});</span>

    <span class="kd">var</span> <span class="nx">LibraryListView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">tagName</span><span class="o">:</span><span class="s1">&#39;span&#39;</span><span class="p">,</span>
        <span class="nx">template</span><span class="o">:</span><span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#LibraryList-template&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">()),</span>

        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>'change .list': 'lib_selected'</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">},</span>

        <span class="nx">initialize</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;reset&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">addOne</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">){</span><span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);},</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;syncing&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;syncing white&quot;</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;syncing white&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>not the strongest solution but it will do</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)){</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">render</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">syncing</span><span class="p">){</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;syncing white&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">}));</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;.list&quot;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span><span class="nx">self</span><span class="p">.</span><span class="nx">lib_selected</span><span class="p">(</span><span class="nx">event</span><span class="p">)});</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">addAll</span><span class="p">();</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">addOne</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lib</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">option</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;option&quot;</span><span class="p">)</span>
            <span class="nx">option</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">lib</span><span class="p">.</span><span class="nx">cid</span><span class="p">;</span>
            <span class="nx">option</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">lib</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;.list&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">option</span><span class="p">);</span><span class="c1">//what&#39;s the null?</span>
        <span class="p">},</span>

        <span class="nx">addAll</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>should show number of problems in the bar</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">lib</span><span class="p">){</span><span class="nx">self</span><span class="p">.</span><span class="nx">addOne</span><span class="p">(</span><span class="nx">lib</span><span class="p">)});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;.list&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;display&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">lib_selected</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;syncing white&quot;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">selectedLib</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">getByCid</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">selectedLib</span><span class="p">){</span>
                <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LibraryListView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span><span class="nx">selectedLib</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">selectedLib</span><span class="p">.</span><span class="nx">cid</span><span class="p">});</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;.children&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
                <span class="nx">libToLoad</span> <span class="o">=</span> <span class="nx">selectedLib</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h2>The main Set view</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">SetView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span><span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#set-template&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">()),</span>
        <span class="nx">events</span><span class="o">:</span><span class="p">{</span>
        <span class="p">},</span>

        <span class="nx">initialize</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span><span class="nx">self</span><span class="p">.</span><span class="nx">addOne</span><span class="p">(</span><span class="nx">model</span><span class="p">)},</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">addAll</span><span class="p">();},</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;[href=#&quot;</span><span class="o">+</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">);</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">){</span><span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);});</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;syncing&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;[href=#&quot;</span><span class="o">+</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;syncing&quot;</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;[href=#&quot;</span><span class="o">+</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;syncing&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">);</span>

        <span class="p">},</span>

        <span class="nx">render</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#problems_container #&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)).</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#problems_container&#39;</span><span class="p">).</span><span class="nx">tabs</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">);</span> <span class="c1">//could move to an after?</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">setElement</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)));</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()));</span>

            <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">syncing</span><span class="p">){</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;[href=#&quot;</span><span class="o">+</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;syncing&quot;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.list&#39;</span><span class="p">).</span><span class="nx">sortable</span><span class="p">({</span>
                <span class="nx">axis</span><span class="o">:</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
                <span class="nx">start</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>self.previousOrder = $(this).sortable('toArray');</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="p">},</span>
                <span class="nx">update</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>self.reorderProblems($(this).sortable('toArray'));</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="kd">var</span> <span class="nx">newOrder</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.list&#39;</span><span class="p">).</span><span class="nx">sortable</span><span class="p">(</span><span class="s1">&#39;toArray&#39;</span><span class="p">);</span>
                    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">newOrder</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
                        <span class="kd">var</span> <span class="nx">problem</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">getByCid</span><span class="p">(</span><span class="nx">newOrder</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                        <span class="k">if</span><span class="p">(</span><span class="nx">problem</span><span class="p">){</span>
                            <span class="nx">problem</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;place&#39;</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">reorder</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">addAll</span><span class="p">();</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">addOne</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">problem</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProblemView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span><span class="nx">problem</span><span class="p">});</span>
            <span class="kd">var</span> <span class="nx">rendered_problem</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.list&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">rendered_problem</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.list&#39;</span><span class="p">).</span><span class="nx">sortable</span><span class="p">(</span><span class="s1">&#39;refresh&#39;</span><span class="p">);</span>

        <span class="p">},</span>

        <span class="nx">addAll</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span><span class="nx">self</span><span class="p">.</span><span class="nx">addOne</span><span class="p">(</span><span class="nx">model</span><span class="p">)});</span>
        <span class="p">}</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h2>The Set view for the setlists</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">SetNameView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">tagName</span><span class="o">:</span><span class="s2">&quot;li&quot;</span><span class="p">,</span>
        <span class="nx">template</span><span class="o">:</span><span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#setName-template&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">()),</span>

        <span class="nx">events</span><span class="o">:</span><span class="p">{</span>
            <span class="s1">&#39;click&#39;</span><span class="o">:</span><span class="s1">&#39;view&#39;</span>
        <span class="p">},</span>

        <span class="nx">initialize</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">bigView</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">render</span><span class="p">()},</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">){</span><span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);});</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;highlight&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;contains_problem&quot;</span><span class="p">)});</span>
        <span class="p">},</span>

        <span class="nx">render</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

            <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">template</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="nx">problem_count</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">}));</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">droppable</span><span class="p">({</span>
                <span class="nx">tolerance</span><span class="o">:</span><span class="s1">&#39;pointer&#39;</span><span class="p">,</span>

                <span class="nx">hoverClass</span><span class="o">:</span><span class="s1">&#39;drophover&#39;</span><span class="p">,</span>

                <span class="nx">drop</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>var newProblem = new webwork.Problem({path:ui.draggable.attr("data-path")});</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;problems&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">({</span><span class="nx">path</span><span class="o">:</span><span class="nx">ui</span><span class="p">.</span><span class="nx">draggable</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;data-path&quot;</span><span class="p">)});</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">view</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;clicked &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#problems_container #&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#problems_container&#39;</span><span class="p">).</span><span class="nx">tabs</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">));</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;rendering the set&quot;</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SetView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>$('#problems_container').append(view.render().el);</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>render the full tab thing, or switch to it</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">}</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h2>The SetList view</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">SetListView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">tagName</span><span class="o">:</span><span class="s2">&quot;ul&quot;</span><span class="p">,</span>
        <span class="nx">template</span><span class="o">:</span><span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#setList-template&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">()),</span>
        <span class="nx">className</span><span class="o">:</span><span class="s2">&quot;nav nav-list&quot;</span><span class="p">,</span>

        <span class="nx">initialize</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span><span class="nx">self</span><span class="p">.</span><span class="nx">addOne</span><span class="p">(</span><span class="nx">model</span><span class="p">);},</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">addAll</span><span class="p">()},</span> <span class="k">this</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>this.model.bind('all', this.render, this);</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)){</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="nx">render</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

            <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">template</span><span class="p">());</span>

            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="nx">addOne</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">added_set</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SetNameView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="nx">added_set</span><span class="p">});</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">addAll</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span><span class="nx">self</span><span class="p">.</span><span class="nx">addOne</span><span class="p">(</span><span class="nx">model</span><span class="p">)});</span>
        <span class="p">}</span>
        <span class="cm">/*</span>
<span class="cm">         startCreate: function(){</span>
<span class="cm">         this.$(&quot;#dialog&quot;).dialog(&#39;open&#39;);</span>
<span class="cm">         }</span>
<span class="cm">         */</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>This is global in order not to confuse the poor select boxes..
They can never tell who went last :)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">libToLoad</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#load_problems&quot;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">libToLoad</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LibraryView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="nx">libToLoad</span><span class="p">});</span>
            <span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>

        <span class="p">}</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>The APP!! yay!!</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">LibraryBrowser</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">el</span><span class="o">:</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#app_box&#39;</span><span class="p">),</span>

        <span class="nx">events</span><span class="o">:</span><span class="p">{</span>
            <span class="s2">&quot;click #undo_button&quot;</span><span class="o">:</span><span class="s2">&quot;undo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;click #redo_button&quot;</span><span class="o">:</span><span class="s2">&quot;redo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hover .problem&quot;</span><span class="o">:</span> <span class="s2">&quot;highlightSets&quot;</span><span class="p">,</span>
            <span class="s2">&quot;click #create_set&quot;</span><span class="o">:</span> <span class="s2">&quot;createHomeworkSet&quot;</span>
        <span class="p">},</span>

        <span class="nx">initialize</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Some default ajax stuff we can keep it or not</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ajaxError</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">jqxhr</span><span class="p">,</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">exception</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="nx">exception</span><span class="p">,</span> <span class="s2">&quot;alert-error&quot;</span><span class="p">);</span>
            <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>get usernames and keys from hidden variables and set up webwork object:</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">myUser</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;hidden_user&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">mySessionKey</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;hidden_key&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">myCourseID</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;hidden_courseID&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>check to make sure that our credentials are available.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">myUser</span> <span class="o">&amp;&amp;</span> <span class="nx">mySessionKey</span> <span class="o">&amp;&amp;</span> <span class="nx">myCourseID</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">webwork</span><span class="p">.</span><span class="nx">requestObject</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">myUser</span><span class="p">;</span>
                <span class="nx">webwork</span><span class="p">.</span><span class="nx">requestObject</span><span class="p">.</span><span class="nx">session_key</span> <span class="o">=</span> <span class="nx">mySessionKey</span><span class="p">;</span>
                <span class="nx">webwork</span><span class="p">.</span><span class="nx">requestObject</span><span class="p">.</span><span class="nx">courseID</span> <span class="o">=</span> <span class="nx">myCourseID</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;missing hidden credentials: user &quot;</span>
                    <span class="o">+</span> <span class="nx">myUser</span> <span class="o">+</span> <span class="s2">&quot; session_key &quot;</span> <span class="o">+</span> <span class="nx">mySessionKey</span>
                    <span class="o">+</span> <span class="s2">&quot; courseID&quot;</span> <span class="o">+</span> <span class="nx">myCourseID</span><span class="p">,</span> <span class="s2">&quot;alert-error&quot;</span><span class="p">);</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Set up the tabbed set lists and libraries:</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#problems_container&quot;</span><span class="p">).</span><span class="nx">tabs</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="nx">closable</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
                    <span class="nx">add</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>document.getElementById("library<em>link").removeChild(document.getElementById("library</em>link").lastChild);</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;adding a tab&quot;</span><span class="p">);</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#problems_container&#39;</span><span class="p">).</span><span class="nx">tabs</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">panel</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.ww_selected&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;ww_selected&quot;</span><span class="p">);</span><span class="c1">// probably reduntant but I want to make sure nothing stays selected</span>
                    <span class="p">},</span>
                    <span class="nx">create</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>document.getElementById("library<em>link").removeChild(document.getElementById("library</em>link").lastChild);</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.ww_selected&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;ww_selected&quot;</span><span class="p">);</span>
                    <span class="p">},</span>
                    <span class="nx">select</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.ww_selected&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;ww_selected&quot;</span><span class="p">);</span>
                    <span class="p">},</span>
                    <span class="nx">remove</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>document.getElementById("library<em>link").removeChild(document.getElementById("library</em>link").lastChild);</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.ww_selected&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;ww_selected&quot;</span><span class="p">);</span>
                    <span class="p">}</span>
            <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>set up our models</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">homeworkSets</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">webwork</span><span class="p">.</span><span class="nx">SetList</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">cardCatalog</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">webwork</span><span class="p">.</span><span class="nx">LibraryList</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">cardCatalog</span><span class="p">.</span><span class="nx">defaultRequestObject</span><span class="p">.</span><span class="nx">xml_command</span> <span class="o">=</span> <span class="s2">&quot;listLibraries&quot;</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
        <span class="p">},</span>

        <span class="nx">createHomeworkSet</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#dialog_text&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">()){</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">homeworkSets</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#dialog_text&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">()});</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#dialog_text&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">highlightSets</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">switch</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">){</span>
                <span class="k">case</span> <span class="s2">&quot;mouseenter&quot;</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>console.log(this.getAttribute("data-path"));</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="kd">var</span> <span class="nx">problemPath</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&quot;data-path&quot;</span><span class="p">);</span>

                    <span class="k">this</span><span class="p">.</span><span class="nx">homeworkSets</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">set</span><span class="p">){</span>
                        <span class="k">if</span><span class="p">(</span><span class="nx">set</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;problems&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">problem</span><span class="p">){</span><span class="k">return</span> <span class="nx">problem</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="nx">problemPath</span><span class="p">})){</span>
                            <span class="nx">set</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;highlight&#39;</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">default</span><span class="o">:</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.contains_problem&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;contains_problem&quot;</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

        <span class="p">},</span>

        <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">homeworkSetsView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SetListView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">homeworkSets</span><span class="p">});</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#homework_sets_container&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">homeworkSetsView</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">cardCatalogView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LibraryListView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">cardCatalog</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;root&quot;</span><span class="p">});</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#CardCatalog&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">cardCatalogView</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
        <span class="p">},</span>

        <span class="nx">undo</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>pop the stack and call the function, that's it</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">undoFunc</span> <span class="o">=</span> <span class="nx">undo_stack</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
            <span class="nx">undoing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nx">undoFunc</span><span class="p">();</span>
        <span class="p">},</span>

        <span class="nx">redo</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">redoFunc</span> <span class="o">=</span> <span class="nx">redo_stack</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
            <span class="nx">redoFunc</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>instantiate an instance of our app.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">App</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LibraryBrowser</span><span class="p">;</span>

<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 